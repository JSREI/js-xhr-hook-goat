<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Response Header Cookie</title>
    <script src="libs/jquery-3.6.0.min.js"></script>
    <script src="libs/crypto-js-4.1.1.min.js"></script>
    <style>
        body {
            font-family: 'Inter', Arial, sans-serif;
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 35px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            margin: 20px 0;
        }
        .header {
            text-align: center;
            margin-bottom: 35px;
            padding-bottom: 25px;
            border-bottom: 3px solid #667eea;
        }
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 32px;
            font-weight: 300;
        }
        .header p {
            color: #7f8c8d;
            margin: 0;
            font-size: 16px;
        }
        .auth-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }
        .section-title {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 24px;
            font-weight: 500;
            text-align: center;
        }
        .auth-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        .auth-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        .auth-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
        }
        .auth-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }
        .auth-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 20px;
        }
        .auth-card p {
            color: #7f8c8d;
            margin: 0 0 15px 0;
            font-size: 14px;
            line-height: 1.5;
        }
        .auth-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }
        .form-container {
            background: white;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            margin-top: 20px;
            display: none;
        }
        .form-container.active {
            display: block;
        }
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group {
            flex: 1;
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        .submit-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .result-section {
            display: none;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            border: 1px solid #e9ecef;
        }
        .result-title {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 20px;
            font-weight: 500;
        }
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .result-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        .result-card h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 16px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }
        .result-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f1f3f4;
        }
        .result-row:last-child {
            border-bottom: none;
        }
        .result-label {
            font-weight: 600;
            color: #2c3e50;
            flex: 1;
        }
        .result-value {
            flex: 1;
            text-align: right;
            color: #495057;
            word-break: break-all;
        }
        .debug-info {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            border: 1px solid #dee2e6;
        }
        .debug-title {
            font-weight: bold;
            margin-bottom: 20px;
            color: #2c3e50;
            font-family: 'Inter', sans-serif;
            font-size: 18px;
        }
        .step-block {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            margin: 15px 0;
            overflow-x: auto;
        }
        .step-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            font-family: 'Inter', sans-serif;
        }
        .code-content {
            color: #e74c3c;
            font-weight: bold;
            word-break: break-all;
            line-height: 1.6;
            font-size: 12px;
        }
        .json-content {
            color: #27ae60;
            white-space: pre-wrap;
        }
        .header-flow {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .flow-step {
            background: #667eea;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin: 5px;
        }
        .flow-arrow {
            color: #667eea;
            font-size: 20px;
            font-weight: bold;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #dc3545;
            margin-top: 20px;
        }
        .success {
            background: #d1ecf1;
            color: #155724;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #28a745;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }
        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #667eea;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .header-info {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            margin-bottom: 20px;
        }
        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f1f3f4;
        }
        .header-row:last-child {
            border-bottom: none;
        }
        .header-label {
            font-weight: 600;
            color: #2c3e50;
        }
        .header-value {
            color: #667eea;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            word-break: break-all;
        }
        .cookie-info {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #c3e6c3;
            margin-bottom: 20px;
        }
        .cookie-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #d4edda;
        }
        .cookie-row:last-child {
            border-bottom: none;
        }
        .cookie-label {
            font-weight: 600;
            color: #155724;
        }
        .cookie-value {
            color: #28a745;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>会话管理平台</h1>
            <p>Response Header Cookie Case - 响应头加密Cookie处理</p>
        </div>

        <div class="auth-section">
            <h2 class="section-title">🔐 选择认证服务</h2>
            
            <div class="auth-cards">
                <div class="auth-card" data-service="login">
                    <span class="auth-icon">🔑</span>
                    <h3>用户登录</h3>
                    <p>用户身份验证，返回加密的会话Cookie和认证令牌</p>
                </div>
                <div class="auth-card" data-service="oauth">
                    <span class="auth-icon">🌐</span>
                    <h3>OAuth授权</h3>
                    <p>第三方OAuth认证，处理授权码和访问令牌</p>
                </div>
                <div class="auth-card" data-service="sso">
                    <span class="auth-icon">🎫</span>
                    <h3>单点登录</h3>
                    <p>企业SSO认证，统一身份管理和权限控制</p>
                </div>
                <div class="auth-card" data-service="refresh">
                    <span class="auth-icon">🔄</span>
                    <h3>令牌刷新</h3>
                    <p>刷新访问令牌，延长会话有效期和权限更新</p>
                </div>
            </div>

            <!-- 用户登录表单 -->
            <div id="loginForm" class="form-container">
                <h3>🔑 用户登录</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="loginUsername">用户名:</label>
                        <input type="text" id="loginUsername" placeholder="请输入用户名" value="admin@company.com">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">密码:</label>
                        <input type="password" id="loginPassword" placeholder="请输入密码" value="SecurePass123!">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="loginRemember">记住登录:</label>
                        <select id="loginRemember" required>
                            <option value="false">否</option>
                            <option value="true" selected>是</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="loginDevice">设备类型:</label>
                        <select id="loginDevice" required>
                            <option value="web" selected>网页端</option>
                            <option value="mobile">移动端</option>
                            <option value="desktop">桌面端</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- OAuth授权表单 -->
            <div id="oauthForm" class="form-container">
                <h3>🌐 OAuth授权</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="oauthProvider">OAuth提供商:</label>
                        <select id="oauthProvider" required>
                            <option value="google">Google</option>
                            <option value="github" selected>GitHub</option>
                            <option value="microsoft">Microsoft</option>
                            <option value="facebook">Facebook</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="oauthCode">授权码:</label>
                        <input type="text" id="oauthCode" placeholder="请输入授权码" value="AUTH_CODE_123456789">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="oauthScope">权限范围:</label>
                        <select id="oauthScope" required>
                            <option value="read">只读权限</option>
                            <option value="write" selected>读写权限</option>
                            <option value="admin">管理员权限</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="oauthState">状态参数:</label>
                        <input type="text" id="oauthState" placeholder="请输入状态参数" value="STATE_RANDOM_STRING">
                    </div>
                </div>
            </div>

            <!-- 单点登录表单 -->
            <div id="ssoForm" class="form-container">
                <h3>🎫 单点登录</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="ssoProvider">SSO提供商:</label>
                        <select id="ssoProvider" required>
                            <option value="ldap">LDAP</option>
                            <option value="saml" selected>SAML</option>
                            <option value="cas">CAS</option>
                            <option value="oidc">OpenID Connect</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ssoTicket">SSO票据:</label>
                        <input type="text" id="ssoTicket" placeholder="请输入SSO票据" value="SSO_TICKET_789012345">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="ssoDomain">域名:</label>
                        <input type="text" id="ssoDomain" placeholder="请输入域名" value="company.com">
                    </div>
                    <div class="form-group">
                        <label for="ssoService">服务标识:</label>
                        <input type="text" id="ssoService" placeholder="请输入服务标识" value="app.company.com">
                    </div>
                </div>
            </div>

            <!-- 令牌刷新表单 -->
            <div id="refreshForm" class="form-container">
                <h3>🔄 令牌刷新</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="refreshToken">刷新令牌:</label>
                        <input type="text" id="refreshToken" placeholder="请输入刷新令牌" value="REFRESH_TOKEN_ABCDEF123456">
                    </div>
                    <div class="form-group">
                        <label for="refreshScope">权限范围:</label>
                        <select id="refreshScope" required>
                            <option value="same">保持原权限</option>
                            <option value="reduced" selected>降低权限</option>
                            <option value="extended">扩展权限</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="refreshExpiry">有效期:</label>
                        <select id="refreshExpiry" required>
                            <option value="1h">1小时</option>
                            <option value="24h" selected>24小时</option>
                            <option value="7d">7天</option>
                            <option value="30d">30天</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="refreshDevice">设备验证:</label>
                        <select id="refreshDevice" required>
                            <option value="skip">跳过验证</option>
                            <option value="verify" selected>验证设备</option>
                            <option value="strict">严格验证</option>
                        </select>
                    </div>
                </div>
            </div>

            <button class="submit-btn" id="submitBtn" disabled>🔐 获取加密响应头Cookie</button>
        </div>

        <div id="resultSection" class="result-section"></div>
        <div id="debugInfo" class="debug-info" style="display: none;"></div>
    </div>

    <script>
        $(document).ready(() => {
            let selectedService = null;
            
            // 检测是否为GitHub Pages环境
            const isGitHubPages = window.location.hostname.includes('github.io');
            
            // 处理服务选择
            $('.auth-card').on('click', function() {
                $('.auth-card').removeClass('selected');
                $(this).addClass('selected');
                selectedService = $(this).data('service');
                
                // 隐藏所有表单
                $('.form-container').removeClass('active');
                
                // 显示对应表单
                const formMap = {
                    'login': 'loginForm',
                    'oauth': 'oauthForm',
                    'sso': 'ssoForm',
                    'refresh': 'refreshForm'
                };
                
                $(`#${formMap[selectedService]}`).addClass('active');
                $('#submitBtn').prop('disabled', false);
            });
            
            // 获取表单数据
            const getFormData = () => {
                const baseData = {
                    service_type: selectedService,
                    timestamp: Math.floor(Date.now() / 1000),
                    client_ip: '192.168.1.100',
                    user_agent: navigator.userAgent.substring(0, 50) + '...'
                };
                
                switch(selectedService) {
                    case 'login':
                        return {
                            ...baseData,
                            username: $('#loginUsername').val(),
                            password: $('#loginPassword').val(),
                            remember: $('#loginRemember').val() === 'true',
                            device_type: $('#loginDevice').val()
                        };
                    case 'oauth':
                        return {
                            ...baseData,
                            provider: $('#oauthProvider').val(),
                            authorization_code: $('#oauthCode').val(),
                            scope: $('#oauthScope').val(),
                            state: $('#oauthState').val()
                        };
                    case 'sso':
                        return {
                            ...baseData,
                            sso_provider: $('#ssoProvider').val(),
                            ticket: $('#ssoTicket').val(),
                            domain: $('#ssoDomain').val(),
                            service: $('#ssoService').val()
                        };
                    case 'refresh':
                        return {
                            ...baseData,
                            refresh_token: $('#refreshToken').val(),
                            scope: $('#refreshScope').val(),
                            expiry: $('#refreshExpiry').val(),
                            device_verification: $('#refreshDevice').val()
                        };
                    default:
                        return baseData;
                }
            };
            
            // 解密Cookie
            const decryptCookie = (encryptedCookie, secretKey = 'cookie-secret-key-2025') => {
                try {
                    const bytes = CryptoJS.AES.decrypt(encryptedCookie, secretKey);
                    const decryptedText = bytes.toString(CryptoJS.enc.Utf8);
                    return JSON.parse(decryptedText);
                } catch (error) {
                    console.error('Cookie解密失败:', error);
                    return null;
                }
            };
            
            // 显示结果
            const displayResult = (data, responseHeaders) => {
                let html = `
                    <h2 class="result-title">✅ 响应头Cookie处理成功</h2>
                    
                    <div class="header-info">
                        <div class="header-row">
                            <span class="header-label">会话ID:</span>
                            <span class="header-value">${data.session_id}</span>
                        </div>
                        <div class="header-row">
                            <span class="header-label">服务类型:</span>
                            <span class="header-value">${data.service_type}</span>
                        </div>
                        <div class="header-row">
                            <span class="header-label">认证状态:</span>
                            <span class="header-value">${data.authenticated ? '认证成功' : '认证失败'}</span>
                        </div>
                        <div class="header-row">
                            <span class="header-label">响应时间:</span>
                            <span class="header-value">${new Date(data.timestamp * 1000).toLocaleString()}</span>
                        </div>
                    </div>
                `;
                
                // 显示解密后的Cookie信息
                if (responseHeaders && responseHeaders['x-cookie']) {
                    const decryptedCookie = decryptCookie(responseHeaders['x-cookie']);
                    if (decryptedCookie) {
                        html += `
                            <div class="cookie-info">
                                <h4>🍪 解密后的Cookie信息</h4>
                                <div class="cookie-row">
                                    <span class="cookie-label">用户ID:</span>
                                    <span class="cookie-value">${decryptedCookie.user_id || 'N/A'}</span>
                                </div>
                                <div class="cookie-row">
                                    <span class="cookie-label">会话令牌:</span>
                                    <span class="cookie-value">${decryptedCookie.session_token || 'N/A'}</span>
                                </div>
                                <div class="cookie-row">
                                    <span class="cookie-label">权限级别:</span>
                                    <span class="cookie-value">${decryptedCookie.permission_level || 'N/A'}</span>
                                </div>
                                <div class="cookie-row">
                                    <span class="cookie-label">过期时间:</span>
                                    <span class="cookie-value">${decryptedCookie.expires_at ? new Date(decryptedCookie.expires_at * 1000).toLocaleString() : 'N/A'}</span>
                                </div>
                            </div>
                        `;
                    }
                }
                
                html += '<div class="result-grid">';
                
                // 根据服务类型显示具体响应数据
                if (data.service_type === 'login' && data.login_result) {
                    const login = data.login_result;
                    html += `
                        <div class="result-card">
                            <h4>🔑 登录结果</h4>
                            <div class="result-row">
                                <span class="result-label">登录状态:</span>
                                <span class="result-value">${login.status}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">用户ID:</span>
                                <span class="result-value">${login.user_id}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">访问令牌:</span>
                                <span class="result-value">${login.access_token}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">令牌类型:</span>
                                <span class="result-value">${login.token_type}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">有效期:</span>
                                <span class="result-value">${login.expires_in}秒</span>
                            </div>
                        </div>
                    `;
                } else if (data.service_type === 'oauth' && data.oauth_result) {
                    const oauth = data.oauth_result;
                    html += `
                        <div class="result-card">
                            <h4>🌐 OAuth结果</h4>
                            <div class="result-row">
                                <span class="result-label">授权状态:</span>
                                <span class="result-value">${oauth.status}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">提供商:</span>
                                <span class="result-value">${oauth.provider}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">访问令牌:</span>
                                <span class="result-value">${oauth.access_token}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">权限范围:</span>
                                <span class="result-value">${oauth.scope}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">用户信息:</span>
                                <span class="result-value">${oauth.user_info}</span>
                            </div>
                        </div>
                    `;
                } else if (data.service_type === 'sso' && data.sso_result) {
                    const sso = data.sso_result;
                    html += `
                        <div class="result-card">
                            <h4>🎫 SSO结果</h4>
                            <div class="result-row">
                                <span class="result-label">SSO状态:</span>
                                <span class="result-value">${sso.status}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">提供商:</span>
                                <span class="result-value">${sso.provider}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">用户标识:</span>
                                <span class="result-value">${sso.user_identifier}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">域名:</span>
                                <span class="result-value">${sso.domain}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">服务票据:</span>
                                <span class="result-value">${sso.service_ticket}</span>
                            </div>
                        </div>
                    `;
                } else if (data.service_type === 'refresh' && data.refresh_result) {
                    const refresh = data.refresh_result;
                    html += `
                        <div class="result-card">
                            <h4>🔄 刷新结果</h4>
                            <div class="result-row">
                                <span class="result-label">刷新状态:</span>
                                <span class="result-value">${refresh.status}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">新访问令牌:</span>
                                <span class="result-value">${refresh.new_access_token}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">新刷新令牌:</span>
                                <span class="result-value">${refresh.new_refresh_token}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">有效期:</span>
                                <span class="result-value">${refresh.expires_in}秒</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">权限范围:</span>
                                <span class="result-value">${refresh.scope}</span>
                            </div>
                        </div>
                    `;
                }
                
                html += '</div>';
                $('#resultSection').html(html).show();
            };
            
            // 显示调试信息
            const showDebugInfo = (formData, responseHeaders, isGitHubPagesMode = false) => {
                const debugHtml = `
                    <div class="debug-title">🔍 调试信息 - 响应头加密Cookie处理过程</div>
                    
                    <div class="header-flow">
                        <div class="flow-step">请求发送</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">服务器认证</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">Cookie加密</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">响应头设置</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">客户端接收</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">Cookie解密</div>
                    </div>
                    
                    <div class="step-title">📤 请求数据</div>
                    <div class="step-block">
                        <div class="step-title">发送的表单数据:</div>
                        <div class="json-content">${JSON.stringify(formData, null, 2)}</div>
                    </div>
                    
                    <div class="step-title">📥 响应头信息</div>
                    <div class="step-block">
                        <div class="step-title">关键响应头:</div>
                        <div class="json-content">X-Cookie: ${responseHeaders && responseHeaders['x-cookie'] ? responseHeaders['x-cookie'].substring(0, 100) + '...' : '未获取到'}
X-Session-Id: ${responseHeaders && responseHeaders['x-session-id'] ? responseHeaders['x-session-id'] : '未获取到'}
X-Auth-Status: ${responseHeaders && responseHeaders['x-auth-status'] ? responseHeaders['x-auth-status'] : '未获取到'}
Content-Type: ${responseHeaders && responseHeaders['content-type'] ? responseHeaders['content-type'] : 'application/json'}</div>
                    </div>
                    
                    ${responseHeaders && responseHeaders['x-cookie'] ? `
                    <div class="step-title">🔓 Cookie解密过程</div>
                    <div class="step-block">
                        <div class="step-title">1. 加密的Cookie (AES):</div>
                        <div class="code-content">${responseHeaders['x-cookie']}</div>
                    </div>
                    <div class="step-block">
                        <div class="step-title">2. 解密后的Cookie内容:</div>
                        <div class="json-content">${JSON.stringify(decryptCookie(responseHeaders['x-cookie']), null, 2)}</div>
                    </div>
                    ` : ''}
                    
                    ${isGitHubPagesMode ? `
                    <div class="step-block">
                        <div style="background: #fff3cd; padding: 15px; border-radius: 6px; border-left: 4px solid #ffc107; margin: 15px 0;">
                            <strong>⚠️ GitHub Pages 环境说明:</strong><br>
                            由于GitHub Pages是静态托管，无法处理真实的响应头设置。<br>
                            本演示使用JSON格式模拟响应头Cookie处理，展示加密和解密流程。<br>
                            在真实环境中，服务器会在响应头中设置加密的X-Cookie。
                        </div>
                    </div>
                    ` : ''}
                    
                    <strong>🔧 响应头加密Cookie优势:</strong><br>
                    • 敏感会话信息通过AES加密保护<br>
                    • 响应头传输避免了Cookie大小限制<br>
                    • 支持复杂的认证和授权信息传递<br>
                    • 防止客户端直接读取敏感信息<br>
                    • 适用于高安全要求的认证系统<br>
                    • 常用于企业级SSO和OAuth系统
                `;
                $('#debugInfo').html(debugHtml).show();
            };
            
            // 提交表单
            $('#submitBtn').on('click', async function() {
                if (!selectedService) {
                    alert('请选择认证服务');
                    return;
                }
                
                // 显示加载状态
                $('#resultSection').html('<div class="loading">🔄 正在处理响应头Cookie...</div>').show();
                $(this).prop('disabled', true).text('🔄 处理中...');
                
                // 获取表单数据
                const formData = getFormData();
                
                // 构建请求URL
                let apiUrl;
                if (isGitHubPages) {
                    apiUrl = `api/response-header-cookie-${selectedService}`;
                } else {
                    apiUrl = 'http://localhost:48159/api/response-header-cookie';
                }
                
                try {
                    if (isGitHubPages) {
                        // GitHub Pages环境：使用JSON模拟
                        const response = await fetch(apiUrl);
                        const jsonResponse = await response.json();
                        
                        if (jsonResponse.success) {
                            displayResult(jsonResponse.data, jsonResponse.headers);
                            showDebugInfo(formData, jsonResponse.headers, true);
                        } else {
                            throw new Error(jsonResponse.message || '请求失败');
                        }
                    } else {
                        // 本地环境：真实的响应头处理
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(formData)
                        });
                        
                        if (response.ok) {
                            const responseData = await response.json();
                            
                            // 获取响应头
                            const responseHeaders = {};
                            response.headers.forEach((value, key) => {
                                responseHeaders[key] = value;
                            });
                            
                            displayResult(responseData, responseHeaders);
                            showDebugInfo(formData, responseHeaders, false);
                        } else {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                    }
                } catch (error) {
                    $('#resultSection').html(`
                        <div class="error">
                            <h3>❌ 请求失败</h3>
                            <p>错误信息: ${error.message}</p>
                            <p>请检查网络连接或稍后重试。</p>
                        </div>
                    `);
                    
                    // 显示调试信息（即使请求失败）
                    showDebugInfo(formData, null, isGitHubPages);
                }
                
                $(this).prop('disabled', false).text('🔐 获取加密响应头Cookie');
            });
            
            // 默认选择第一个服务
            $('.auth-card').first().click();
        });
    </script>
</body>
</html>

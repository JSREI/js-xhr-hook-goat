<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Response Header Cookie</title>
    <script src="libs/jquery-3.6.0.min.js"></script>
    <script src="libs/crypto-js-4.1.1.min.js"></script>
    <style>
        body {
            font-family: 'Inter', Arial, sans-serif;
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 35px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            margin: 20px 0;
        }
        .header {
            text-align: center;
            margin-bottom: 35px;
            padding-bottom: 25px;
            border-bottom: 3px solid #667eea;
        }
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 32px;
            font-weight: 300;
        }
        .header p {
            color: #7f8c8d;
            margin: 0;
            font-size: 16px;
        }
        .auth-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }
        .section-title {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 24px;
            font-weight: 500;
            text-align: center;
        }
        .auth-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        .auth-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        .auth-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
        }
        .auth-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }
        .auth-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 20px;
        }
        .auth-card p {
            color: #7f8c8d;
            margin: 0 0 15px 0;
            font-size: 14px;
            line-height: 1.5;
        }
        .auth-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }
        .form-container {
            background: white;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            margin-top: 20px;
            display: none;
        }
        .form-container.active {
            display: block;
        }
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group {
            flex: 1;
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        .submit-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .result-section {
            display: none;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            border: 1px solid #e9ecef;
        }
        .result-title {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 20px;
            font-weight: 500;
        }
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .result-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        .result-card h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 16px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }
        .result-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f1f3f4;
        }
        .result-row:last-child {
            border-bottom: none;
        }
        .result-label {
            font-weight: 600;
            color: #2c3e50;
            flex: 1;
        }
        .result-value {
            flex: 1;
            text-align: right;
            color: #495057;
            word-break: break-all;
        }
        .debug-info {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            border: 1px solid #dee2e6;
        }
        .debug-title {
            font-weight: bold;
            margin-bottom: 20px;
            color: #2c3e50;
            font-family: 'Inter', sans-serif;
            font-size: 18px;
        }
        .step-block {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            margin: 15px 0;
            overflow-x: auto;
        }
        .step-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            font-family: 'Inter', sans-serif;
        }
        .code-content {
            color: #e74c3c;
            font-weight: bold;
            word-break: break-all;
            line-height: 1.6;
            font-size: 12px;
        }
        .json-content {
            color: #27ae60;
            white-space: pre-wrap;
        }
        .header-flow {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .flow-step {
            background: #667eea;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin: 5px;
        }
        .flow-arrow {
            color: #667eea;
            font-size: 20px;
            font-weight: bold;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #dc3545;
            margin-top: 20px;
        }
        .success {
            background: #d1ecf1;
            color: #155724;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #28a745;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }
        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #667eea;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .header-info {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            margin-bottom: 20px;
        }
        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f1f3f4;
        }
        .header-row:last-child {
            border-bottom: none;
        }
        .header-label {
            font-weight: 600;
            color: #2c3e50;
        }
        .header-value {
            color: #667eea;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            word-break: break-all;
        }
        .cookie-info {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #c3e6c3;
            margin-bottom: 20px;
        }
        .cookie-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #d4edda;
        }
        .cookie-row:last-child {
            border-bottom: none;
        }
        .cookie-label {
            font-weight: 600;
            color: #155724;
        }
        .cookie-value {
            color: #28a745;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ä¼šè¯ç®¡ç†å¹³å°</h1>
            <p>Response Header Cookie Case - å“åº”å¤´åŠ å¯†Cookieå¤„ç†</p>
        </div>

        <div class="auth-section">
            <h2 class="section-title">ğŸ” é€‰æ‹©è®¤è¯æœåŠ¡</h2>
            
            <div class="auth-cards">
                <div class="auth-card" data-service="login">
                    <span class="auth-icon">ğŸ”‘</span>
                    <h3>ç”¨æˆ·ç™»å½•</h3>
                    <p>ç”¨æˆ·èº«ä»½éªŒè¯ï¼Œè¿”å›åŠ å¯†çš„ä¼šè¯Cookieå’Œè®¤è¯ä»¤ç‰Œ</p>
                </div>
                <div class="auth-card" data-service="oauth">
                    <span class="auth-icon">ğŸŒ</span>
                    <h3>OAuthæˆæƒ</h3>
                    <p>ç¬¬ä¸‰æ–¹OAuthè®¤è¯ï¼Œå¤„ç†æˆæƒç å’Œè®¿é—®ä»¤ç‰Œ</p>
                </div>
                <div class="auth-card" data-service="sso">
                    <span class="auth-icon">ğŸ«</span>
                    <h3>å•ç‚¹ç™»å½•</h3>
                    <p>ä¼ä¸šSSOè®¤è¯ï¼Œç»Ÿä¸€èº«ä»½ç®¡ç†å’Œæƒé™æ§åˆ¶</p>
                </div>
                <div class="auth-card" data-service="refresh">
                    <span class="auth-icon">ğŸ”„</span>
                    <h3>ä»¤ç‰Œåˆ·æ–°</h3>
                    <p>åˆ·æ–°è®¿é—®ä»¤ç‰Œï¼Œå»¶é•¿ä¼šè¯æœ‰æ•ˆæœŸå’Œæƒé™æ›´æ–°</p>
                </div>
            </div>

            <!-- ç”¨æˆ·ç™»å½•è¡¨å• -->
            <div id="loginForm" class="form-container">
                <h3>ğŸ”‘ ç”¨æˆ·ç™»å½•</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="loginUsername">ç”¨æˆ·å:</label>
                        <input type="text" id="loginUsername" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" value="admin@company.com">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">å¯†ç :</label>
                        <input type="password" id="loginPassword" placeholder="è¯·è¾“å…¥å¯†ç " value="SecurePass123!">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="loginRemember">è®°ä½ç™»å½•:</label>
                        <select id="loginRemember" required>
                            <option value="false">å¦</option>
                            <option value="true" selected>æ˜¯</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="loginDevice">è®¾å¤‡ç±»å‹:</label>
                        <select id="loginDevice" required>
                            <option value="web" selected>ç½‘é¡µç«¯</option>
                            <option value="mobile">ç§»åŠ¨ç«¯</option>
                            <option value="desktop">æ¡Œé¢ç«¯</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- OAuthæˆæƒè¡¨å• -->
            <div id="oauthForm" class="form-container">
                <h3>ğŸŒ OAuthæˆæƒ</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="oauthProvider">OAuthæä¾›å•†:</label>
                        <select id="oauthProvider" required>
                            <option value="google">Google</option>
                            <option value="github" selected>GitHub</option>
                            <option value="microsoft">Microsoft</option>
                            <option value="facebook">Facebook</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="oauthCode">æˆæƒç :</label>
                        <input type="text" id="oauthCode" placeholder="è¯·è¾“å…¥æˆæƒç " value="AUTH_CODE_123456789">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="oauthScope">æƒé™èŒƒå›´:</label>
                        <select id="oauthScope" required>
                            <option value="read">åªè¯»æƒé™</option>
                            <option value="write" selected>è¯»å†™æƒé™</option>
                            <option value="admin">ç®¡ç†å‘˜æƒé™</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="oauthState">çŠ¶æ€å‚æ•°:</label>
                        <input type="text" id="oauthState" placeholder="è¯·è¾“å…¥çŠ¶æ€å‚æ•°" value="STATE_RANDOM_STRING">
                    </div>
                </div>
            </div>

            <!-- å•ç‚¹ç™»å½•è¡¨å• -->
            <div id="ssoForm" class="form-container">
                <h3>ğŸ« å•ç‚¹ç™»å½•</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="ssoProvider">SSOæä¾›å•†:</label>
                        <select id="ssoProvider" required>
                            <option value="ldap">LDAP</option>
                            <option value="saml" selected>SAML</option>
                            <option value="cas">CAS</option>
                            <option value="oidc">OpenID Connect</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ssoTicket">SSOç¥¨æ®:</label>
                        <input type="text" id="ssoTicket" placeholder="è¯·è¾“å…¥SSOç¥¨æ®" value="SSO_TICKET_789012345">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="ssoDomain">åŸŸå:</label>
                        <input type="text" id="ssoDomain" placeholder="è¯·è¾“å…¥åŸŸå" value="company.com">
                    </div>
                    <div class="form-group">
                        <label for="ssoService">æœåŠ¡æ ‡è¯†:</label>
                        <input type="text" id="ssoService" placeholder="è¯·è¾“å…¥æœåŠ¡æ ‡è¯†" value="app.company.com">
                    </div>
                </div>
            </div>

            <!-- ä»¤ç‰Œåˆ·æ–°è¡¨å• -->
            <div id="refreshForm" class="form-container">
                <h3>ğŸ”„ ä»¤ç‰Œåˆ·æ–°</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="refreshToken">åˆ·æ–°ä»¤ç‰Œ:</label>
                        <input type="text" id="refreshToken" placeholder="è¯·è¾“å…¥åˆ·æ–°ä»¤ç‰Œ" value="REFRESH_TOKEN_ABCDEF123456">
                    </div>
                    <div class="form-group">
                        <label for="refreshScope">æƒé™èŒƒå›´:</label>
                        <select id="refreshScope" required>
                            <option value="same">ä¿æŒåŸæƒé™</option>
                            <option value="reduced" selected>é™ä½æƒé™</option>
                            <option value="extended">æ‰©å±•æƒé™</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="refreshExpiry">æœ‰æ•ˆæœŸ:</label>
                        <select id="refreshExpiry" required>
                            <option value="1h">1å°æ—¶</option>
                            <option value="24h" selected>24å°æ—¶</option>
                            <option value="7d">7å¤©</option>
                            <option value="30d">30å¤©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="refreshDevice">è®¾å¤‡éªŒè¯:</label>
                        <select id="refreshDevice" required>
                            <option value="skip">è·³è¿‡éªŒè¯</option>
                            <option value="verify" selected>éªŒè¯è®¾å¤‡</option>
                            <option value="strict">ä¸¥æ ¼éªŒè¯</option>
                        </select>
                    </div>
                </div>
            </div>

            <button class="submit-btn" id="submitBtn" disabled>ğŸ” è·å–åŠ å¯†å“åº”å¤´Cookie</button>
        </div>

        <div id="resultSection" class="result-section"></div>
        <div id="debugInfo" class="debug-info" style="display: none;"></div>
    </div>

    <script>
        $(document).ready(() => {
            let selectedService = null;
            
            // æ£€æµ‹æ˜¯å¦ä¸ºGitHub Pagesç¯å¢ƒ
            const isGitHubPages = window.location.hostname.includes('github.io');
            
            // å¤„ç†æœåŠ¡é€‰æ‹©
            $('.auth-card').on('click', function() {
                $('.auth-card').removeClass('selected');
                $(this).addClass('selected');
                selectedService = $(this).data('service');
                
                // éšè—æ‰€æœ‰è¡¨å•
                $('.form-container').removeClass('active');
                
                // æ˜¾ç¤ºå¯¹åº”è¡¨å•
                const formMap = {
                    'login': 'loginForm',
                    'oauth': 'oauthForm',
                    'sso': 'ssoForm',
                    'refresh': 'refreshForm'
                };
                
                $(`#${formMap[selectedService]}`).addClass('active');
                $('#submitBtn').prop('disabled', false);
            });
            
            // è·å–è¡¨å•æ•°æ®
            const getFormData = () => {
                const baseData = {
                    service_type: selectedService,
                    timestamp: Math.floor(Date.now() / 1000),
                    client_ip: '192.168.1.100',
                    user_agent: navigator.userAgent.substring(0, 50) + '...'
                };
                
                switch(selectedService) {
                    case 'login':
                        return {
                            ...baseData,
                            username: $('#loginUsername').val(),
                            password: $('#loginPassword').val(),
                            remember: $('#loginRemember').val() === 'true',
                            device_type: $('#loginDevice').val()
                        };
                    case 'oauth':
                        return {
                            ...baseData,
                            provider: $('#oauthProvider').val(),
                            authorization_code: $('#oauthCode').val(),
                            scope: $('#oauthScope').val(),
                            state: $('#oauthState').val()
                        };
                    case 'sso':
                        return {
                            ...baseData,
                            sso_provider: $('#ssoProvider').val(),
                            ticket: $('#ssoTicket').val(),
                            domain: $('#ssoDomain').val(),
                            service: $('#ssoService').val()
                        };
                    case 'refresh':
                        return {
                            ...baseData,
                            refresh_token: $('#refreshToken').val(),
                            scope: $('#refreshScope').val(),
                            expiry: $('#refreshExpiry').val(),
                            device_verification: $('#refreshDevice').val()
                        };
                    default:
                        return baseData;
                }
            };
            
            // è§£å¯†Cookie
            const decryptCookie = (encryptedCookie, secretKey = 'cookie-secret-key-2025') => {
                try {
                    const bytes = CryptoJS.AES.decrypt(encryptedCookie, secretKey);
                    const decryptedText = bytes.toString(CryptoJS.enc.Utf8);
                    return JSON.parse(decryptedText);
                } catch (error) {
                    console.error('Cookieè§£å¯†å¤±è´¥:', error);
                    return null;
                }
            };
            
            // æ˜¾ç¤ºç»“æœ
            const displayResult = (data, responseHeaders) => {
                let html = `
                    <h2 class="result-title">âœ… å“åº”å¤´Cookieå¤„ç†æˆåŠŸ</h2>
                    
                    <div class="header-info">
                        <div class="header-row">
                            <span class="header-label">ä¼šè¯ID:</span>
                            <span class="header-value">${data.session_id}</span>
                        </div>
                        <div class="header-row">
                            <span class="header-label">æœåŠ¡ç±»å‹:</span>
                            <span class="header-value">${data.service_type}</span>
                        </div>
                        <div class="header-row">
                            <span class="header-label">è®¤è¯çŠ¶æ€:</span>
                            <span class="header-value">${data.authenticated ? 'è®¤è¯æˆåŠŸ' : 'è®¤è¯å¤±è´¥'}</span>
                        </div>
                        <div class="header-row">
                            <span class="header-label">å“åº”æ—¶é—´:</span>
                            <span class="header-value">${new Date(data.timestamp * 1000).toLocaleString()}</span>
                        </div>
                    </div>
                `;
                
                // æ˜¾ç¤ºè§£å¯†åçš„Cookieä¿¡æ¯
                if (responseHeaders && responseHeaders['x-cookie']) {
                    const decryptedCookie = decryptCookie(responseHeaders['x-cookie']);
                    if (decryptedCookie) {
                        html += `
                            <div class="cookie-info">
                                <h4>ğŸª è§£å¯†åçš„Cookieä¿¡æ¯</h4>
                                <div class="cookie-row">
                                    <span class="cookie-label">ç”¨æˆ·ID:</span>
                                    <span class="cookie-value">${decryptedCookie.user_id || 'N/A'}</span>
                                </div>
                                <div class="cookie-row">
                                    <span class="cookie-label">ä¼šè¯ä»¤ç‰Œ:</span>
                                    <span class="cookie-value">${decryptedCookie.session_token || 'N/A'}</span>
                                </div>
                                <div class="cookie-row">
                                    <span class="cookie-label">æƒé™çº§åˆ«:</span>
                                    <span class="cookie-value">${decryptedCookie.permission_level || 'N/A'}</span>
                                </div>
                                <div class="cookie-row">
                                    <span class="cookie-label">è¿‡æœŸæ—¶é—´:</span>
                                    <span class="cookie-value">${decryptedCookie.expires_at ? new Date(decryptedCookie.expires_at * 1000).toLocaleString() : 'N/A'}</span>
                                </div>
                            </div>
                        `;
                    }
                }
                
                html += '<div class="result-grid">';
                
                // æ ¹æ®æœåŠ¡ç±»å‹æ˜¾ç¤ºå…·ä½“å“åº”æ•°æ®
                if (data.service_type === 'login' && data.login_result) {
                    const login = data.login_result;
                    html += `
                        <div class="result-card">
                            <h4>ğŸ”‘ ç™»å½•ç»“æœ</h4>
                            <div class="result-row">
                                <span class="result-label">ç™»å½•çŠ¶æ€:</span>
                                <span class="result-value">${login.status}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">ç”¨æˆ·ID:</span>
                                <span class="result-value">${login.user_id}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">è®¿é—®ä»¤ç‰Œ:</span>
                                <span class="result-value">${login.access_token}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">ä»¤ç‰Œç±»å‹:</span>
                                <span class="result-value">${login.token_type}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">æœ‰æ•ˆæœŸ:</span>
                                <span class="result-value">${login.expires_in}ç§’</span>
                            </div>
                        </div>
                    `;
                } else if (data.service_type === 'oauth' && data.oauth_result) {
                    const oauth = data.oauth_result;
                    html += `
                        <div class="result-card">
                            <h4>ğŸŒ OAuthç»“æœ</h4>
                            <div class="result-row">
                                <span class="result-label">æˆæƒçŠ¶æ€:</span>
                                <span class="result-value">${oauth.status}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">æä¾›å•†:</span>
                                <span class="result-value">${oauth.provider}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">è®¿é—®ä»¤ç‰Œ:</span>
                                <span class="result-value">${oauth.access_token}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">æƒé™èŒƒå›´:</span>
                                <span class="result-value">${oauth.scope}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">ç”¨æˆ·ä¿¡æ¯:</span>
                                <span class="result-value">${oauth.user_info}</span>
                            </div>
                        </div>
                    `;
                } else if (data.service_type === 'sso' && data.sso_result) {
                    const sso = data.sso_result;
                    html += `
                        <div class="result-card">
                            <h4>ğŸ« SSOç»“æœ</h4>
                            <div class="result-row">
                                <span class="result-label">SSOçŠ¶æ€:</span>
                                <span class="result-value">${sso.status}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">æä¾›å•†:</span>
                                <span class="result-value">${sso.provider}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">ç”¨æˆ·æ ‡è¯†:</span>
                                <span class="result-value">${sso.user_identifier}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">åŸŸå:</span>
                                <span class="result-value">${sso.domain}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">æœåŠ¡ç¥¨æ®:</span>
                                <span class="result-value">${sso.service_ticket}</span>
                            </div>
                        </div>
                    `;
                } else if (data.service_type === 'refresh' && data.refresh_result) {
                    const refresh = data.refresh_result;
                    html += `
                        <div class="result-card">
                            <h4>ğŸ”„ åˆ·æ–°ç»“æœ</h4>
                            <div class="result-row">
                                <span class="result-label">åˆ·æ–°çŠ¶æ€:</span>
                                <span class="result-value">${refresh.status}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">æ–°è®¿é—®ä»¤ç‰Œ:</span>
                                <span class="result-value">${refresh.new_access_token}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">æ–°åˆ·æ–°ä»¤ç‰Œ:</span>
                                <span class="result-value">${refresh.new_refresh_token}</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">æœ‰æ•ˆæœŸ:</span>
                                <span class="result-value">${refresh.expires_in}ç§’</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">æƒé™èŒƒå›´:</span>
                                <span class="result-value">${refresh.scope}</span>
                            </div>
                        </div>
                    `;
                }
                
                html += '</div>';
                $('#resultSection').html(html).show();
            };
            
            // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
            const showDebugInfo = (formData, responseHeaders, isGitHubPagesMode = false) => {
                const debugHtml = `
                    <div class="debug-title">ğŸ” è°ƒè¯•ä¿¡æ¯ - å“åº”å¤´åŠ å¯†Cookieå¤„ç†è¿‡ç¨‹</div>
                    
                    <div class="header-flow">
                        <div class="flow-step">è¯·æ±‚å‘é€</div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-step">æœåŠ¡å™¨è®¤è¯</div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-step">CookieåŠ å¯†</div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-step">å“åº”å¤´è®¾ç½®</div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-step">å®¢æˆ·ç«¯æ¥æ”¶</div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-step">Cookieè§£å¯†</div>
                    </div>
                    
                    <div class="step-title">ğŸ“¤ è¯·æ±‚æ•°æ®</div>
                    <div class="step-block">
                        <div class="step-title">å‘é€çš„è¡¨å•æ•°æ®:</div>
                        <div class="json-content">${JSON.stringify(formData, null, 2)}</div>
                    </div>
                    
                    <div class="step-title">ğŸ“¥ å“åº”å¤´ä¿¡æ¯</div>
                    <div class="step-block">
                        <div class="step-title">å…³é”®å“åº”å¤´:</div>
                        <div class="json-content">X-Cookie: ${responseHeaders && responseHeaders['x-cookie'] ? responseHeaders['x-cookie'].substring(0, 100) + '...' : 'æœªè·å–åˆ°'}
X-Session-Id: ${responseHeaders && responseHeaders['x-session-id'] ? responseHeaders['x-session-id'] : 'æœªè·å–åˆ°'}
X-Auth-Status: ${responseHeaders && responseHeaders['x-auth-status'] ? responseHeaders['x-auth-status'] : 'æœªè·å–åˆ°'}
Content-Type: ${responseHeaders && responseHeaders['content-type'] ? responseHeaders['content-type'] : 'application/json'}</div>
                    </div>
                    
                    ${responseHeaders && responseHeaders['x-cookie'] ? `
                    <div class="step-title">ğŸ”“ Cookieè§£å¯†è¿‡ç¨‹</div>
                    <div class="step-block">
                        <div class="step-title">1. åŠ å¯†çš„Cookie (AES):</div>
                        <div class="code-content">${responseHeaders['x-cookie']}</div>
                    </div>
                    <div class="step-block">
                        <div class="step-title">2. è§£å¯†åçš„Cookieå†…å®¹:</div>
                        <div class="json-content">${JSON.stringify(decryptCookie(responseHeaders['x-cookie']), null, 2)}</div>
                    </div>
                    ` : ''}
                    
                    ${isGitHubPagesMode ? `
                    <div class="step-block">
                        <div style="background: #fff3cd; padding: 15px; border-radius: 6px; border-left: 4px solid #ffc107; margin: 15px 0;">
                            <strong>âš ï¸ GitHub Pages ç¯å¢ƒè¯´æ˜:</strong><br>
                            ç”±äºGitHub Pagesæ˜¯é™æ€æ‰˜ç®¡ï¼Œæ— æ³•å¤„ç†çœŸå®çš„å“åº”å¤´è®¾ç½®ã€‚<br>
                            æœ¬æ¼”ç¤ºä½¿ç”¨JSONæ ¼å¼æ¨¡æ‹Ÿå“åº”å¤´Cookieå¤„ç†ï¼Œå±•ç¤ºåŠ å¯†å’Œè§£å¯†æµç¨‹ã€‚<br>
                            åœ¨çœŸå®ç¯å¢ƒä¸­ï¼ŒæœåŠ¡å™¨ä¼šåœ¨å“åº”å¤´ä¸­è®¾ç½®åŠ å¯†çš„X-Cookieã€‚
                        </div>
                    </div>
                    ` : ''}
                    
                    <strong>ğŸ”§ å“åº”å¤´åŠ å¯†Cookieä¼˜åŠ¿:</strong><br>
                    â€¢ æ•æ„Ÿä¼šè¯ä¿¡æ¯é€šè¿‡AESåŠ å¯†ä¿æŠ¤<br>
                    â€¢ å“åº”å¤´ä¼ è¾“é¿å…äº†Cookieå¤§å°é™åˆ¶<br>
                    â€¢ æ”¯æŒå¤æ‚çš„è®¤è¯å’Œæˆæƒä¿¡æ¯ä¼ é€’<br>
                    â€¢ é˜²æ­¢å®¢æˆ·ç«¯ç›´æ¥è¯»å–æ•æ„Ÿä¿¡æ¯<br>
                    â€¢ é€‚ç”¨äºé«˜å®‰å…¨è¦æ±‚çš„è®¤è¯ç³»ç»Ÿ<br>
                    â€¢ å¸¸ç”¨äºä¼ä¸šçº§SSOå’ŒOAuthç³»ç»Ÿ
                `;
                $('#debugInfo').html(debugHtml).show();
            };
            
            // æäº¤è¡¨å•
            $('#submitBtn').on('click', async function() {
                if (!selectedService) {
                    alert('è¯·é€‰æ‹©è®¤è¯æœåŠ¡');
                    return;
                }
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                $('#resultSection').html('<div class="loading">ğŸ”„ æ­£åœ¨å¤„ç†å“åº”å¤´Cookie...</div>').show();
                $(this).prop('disabled', true).text('ğŸ”„ å¤„ç†ä¸­...');
                
                // è·å–è¡¨å•æ•°æ®
                const formData = getFormData();
                
                // æ„å»ºè¯·æ±‚URL
                let apiUrl;
                if (isGitHubPages) {
                    apiUrl = `api/response-header-cookie-${selectedService}`;
                } else {
                    apiUrl = 'http://localhost:48159/api/response-header-cookie';
                }
                
                try {
                    if (isGitHubPages) {
                        // GitHub Pagesç¯å¢ƒï¼šä½¿ç”¨JSONæ¨¡æ‹Ÿ
                        const response = await fetch(apiUrl);
                        const jsonResponse = await response.json();
                        
                        if (jsonResponse.success) {
                            displayResult(jsonResponse.data, jsonResponse.headers);
                            showDebugInfo(formData, jsonResponse.headers, true);
                        } else {
                            throw new Error(jsonResponse.message || 'è¯·æ±‚å¤±è´¥');
                        }
                    } else {
                        // æœ¬åœ°ç¯å¢ƒï¼šçœŸå®çš„å“åº”å¤´å¤„ç†
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(formData)
                        });
                        
                        if (response.ok) {
                            const responseData = await response.json();
                            
                            // è·å–å“åº”å¤´
                            const responseHeaders = {};
                            response.headers.forEach((value, key) => {
                                responseHeaders[key] = value;
                            });
                            
                            displayResult(responseData, responseHeaders);
                            showDebugInfo(formData, responseHeaders, false);
                        } else {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                    }
                } catch (error) {
                    $('#resultSection').html(`
                        <div class="error">
                            <h3>âŒ è¯·æ±‚å¤±è´¥</h3>
                            <p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                            <p>è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•ã€‚</p>
                        </div>
                    `);
                    
                    // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ï¼ˆå³ä½¿è¯·æ±‚å¤±è´¥ï¼‰
                    showDebugInfo(formData, null, isGitHubPages);
                }
                
                $(this).prop('disabled', false).text('ğŸ” è·å–åŠ å¯†å“åº”å¤´Cookie');
            });
            
            // é»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ªæœåŠ¡
            $('.auth-card').first().click();
        });
    </script>
</body>
</html>
